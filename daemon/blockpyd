#!/bin/env python3

import datetime, json
import time

path_to_json="./my_json.json"

now = datetime.datetime.now()
hour = now.hour
# # for MVP only hour
# minute = now.minute

print("Running in hour %d" % hour)

def load_json():
    json_file = open(path_to_json,'r+')
    text = json_file.read()
    json_file.close()
    return json.loads(text)


def is_time_between(begin_time, end_time, check_time=None):
    # If check time is not given, default to current UTC time
    check_time = check_time or datetime.datetime.utcnow().time()
    if begin_time < end_time:
        return check_time >= begin_time and check_time <= end_time
    else: # crosses midnight
        return check_time >= begin_time or check_time <= end_time


out = "##-----GENERATED BY BLOCKPY-----##\n"
websites = load_json()
for website in websites :
    value = websites[website]

    turn_on = int(value[0])
    turn_off = int(value[1])
    between = is_time_between(datetime.time(turn_on, 00), datetime.time(turn_off, 00), datetime.time(hour,00))
    if(between):
        out += "0.0.0.0 %s \n"%website
        out += "0.0.0.0 www.%s \n"%website
        out += "0.0.0.0 https://www.%s \n"%website


print(out)